

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>xpipeline an explanation &mdash; xpipeline 0+untagged.99.g8960fa3.dirty documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/xpipeline-docs.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Running xpipeline-workflow on the command line" href="../command-line/index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> xpipeline
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.99.g8960fa3.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../command-line/index.html">Running <code class="docutils literal notranslate"><span class="pre">xpipeline-workflow</span></code> on the command line</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">xpipeline an explanation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-time-frequency-map">The Time-Frequency Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-coherent-time-frequency-map">The Coherent Time-Frequency Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clustering-pixels">Clustering Pixels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-dominant-polarization-frame">The Dominant Polarization Frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="#likelihoods">Likelihoods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-waveform">The Waveform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-injection">The Injection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xpipeline</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>xpipeline an explanation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xpipeline-an-explanation">
<span id="examples"></span><h1>xpipeline an explanation<a class="headerlink" href="#xpipeline-an-explanation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Xpipeline is an unmodelled Gravitational Wave Burst analysis algorithm aimed at
using coherent detection statistics as well as coherent conistency checks to eliminate
surperfluous noise transients and extact real gravitational wave events from the data.</p>
<p>In order to build the statistics necessary to claim a detection
and to calculate the coherent statistics needed to eliminate excess back ground noise,
xpipeline conists of performing the same statistical “trials” over stretches of
data that couldhave a gravitational wave event and data which it is
either not believed or not possible for it to contain a graviational wave event.
In addition to these two stretches of data, an analysis is also performed on a
variety of simulated signals which is injected
into the data that is believed to contain a graviational wave in order that we
may understand what to expect from an actual gravitational wave
if it were to appear in the data during the stretch fo time believed to contain and gravitational wave.</p>
<p>Below we highlight what one of these “statistical trials” look like (either for the time
that does or does not contain a graviational wave). First, we use time from a known graviational wave event
to hightlight what the trial would look like for it, and then second we use a known noise transient
to see what it would look like for it.</p>
<p>In this breakdown, we imagine we are running over a stretch of data due to an
alert from a electromagnetic countrpart, i.e. an event that is believed to create
photometric and graviational wave signatures.</p>
<p>Through the alert, there is some timestamp considered as an “event time”, and around said
event time is some stretch of probable time that could contain the graviational wave counterpart to the
observation.</p>
<p>The data corresponding to the appropriate stretch of plausible time when
the gravitational wave could have passed through earth is obtained for N detectors
that were operating during that time.</p>
<p>The data from these N detectors are then FFT’ed and taken from time-amplitude
into time-frequency space. Since we have a plausible sky location of the source,
not only can we shrink the amount of data we search for a graviational wave over,
we can combine the data streams from the N detectors based on the known travel time of
graviational wave (i.e. the speed of light).</p>
<p>The tfmaps of N-1 detectors are time/phase shifted appropriately with the sky
location (locations if there is some error box).</p>
<p>From these individual maps loud time-frequency pixels are identified and
a “coherent” set of pixels is calculated from the overlap of these individually loud pixels.</p>
<p>After these coherent (overlapping) pixels are calculted a chosen “clustering” algorithm is
applied to the pizels that group near by loud pixels into possible graviational wave candidate events.</p>
<p>So essentially, our possible grviational wave events are simply a cluster of loud time frequency pixels upon
which numerous fancy statistics will be applied (these statistics often are called coherent statistics as
they are most useful when N streams of data can be projected combined together).</p>
<p>Specificlly, these clusters then are assigned a variety of <em>likelihoods</em> these <em>likelihoods</em> for each cluster are based on the concept of translating the data in the dominant polarization frame i.e. plus and cross polarized time frequency maps instead of the standard time frequency maps considered above.</p>
<p>So the final important stat calculated is energy_of_cluster * likelihood_of_cluster for a given likelihood.</p>
<p>These likelihood rely largely on the ability to project the N stream of gravitational wave data in the relative antenna response pattern weighted time frequency space (so fplus fcross, fscalar, etc)</p>
<p>In order to calculate these antenna weighted tfmaps we need to re-weight the ASDs of the data streams appropriately. This re-weighted ASD is then multiplied with the time frequency map obtained normally above.</p>
<p>So let us see what the above looks like if we had had an counterpart signal to the very
first graviational wave detection.</p>
<div class="section" id="the-time-frequency-map">
<h3>The Time-Frequency Map<a class="headerlink" href="#the-time-frequency-map" title="Permalink to this headline">¶</a></h3>
<p>The following is all open data obtained via <a class="reference external" href="https://losc.ligo.org/">LOSC</a></p>
<p>Data from Hanford and Livingston is obtained, and then whitened (one can think of this as a normalization process).
The realty is that our detectors are more or less senstive to different frequencies and therefore in order
to detect excess noise we must first “whiten that data.”</p>
<p>As I know the event time I have zoomed in close on the over all time frequnecy map
so that the signal is quite clear even without any fancy statistics. Nonetheless,
let us go through the whole process.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">xpipeline.core.xtimeseries</span> <span class="kn">import</span> <span class="n">XTimeSeries</span>

<span class="gp">In [2]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">XTimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;examples/GW150914.gwf&#39;</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H1:GDS-CALIB_STRAIN&#39;</span><span class="p">,</span><span class="s1">&#39;L1:GDS-CALIB_STRAIN&#39;</span><span class="p">])</span>

<span class="gp">In [3]: </span><span class="n">asds</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asd</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">In [4]: </span><span class="n">whitened_timeseries</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">whiten</span><span class="p">(</span><span class="n">asds</span><span class="p">)</span>

<span class="gp">In [5]: </span><span class="n">fft_maps</span> <span class="o">=</span> <span class="n">whitened_timeseries</span><span class="o">.</span><span class="n">fftgram</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span><span class="mi">64</span><span class="p">)</span>

<span class="gp">In [6]: </span><span class="n">energy_maps</span> <span class="o">=</span> <span class="n">fft_maps</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="gp">In [7]: </span><span class="n">gps</span> <span class="o">=</span> <span class="mf">1126259462.427</span>

<span class="gp">In [8]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">energy_maps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="gp">In [9]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ...: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">gps</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">gps</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="gp">   ...: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>
<span class="gp">   ...: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ...: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [10]: </span><span class="n">plot</span>
<span class="gh">Out[10]: </span><span class="go">&lt;SpectrogramPlot size 1200x600 with 2 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/plot-time-frequency-map.png" src="../_images/plot-time-frequency-map.png" />
</div>
<div class="section" id="the-coherent-time-frequency-map">
<h3>The Coherent Time-Frequency Map<a class="headerlink" href="#the-coherent-time-frequency-map" title="Permalink to this headline">¶</a></h3>
<p>In the above example you may notice that the data streams from both detectors do not seem to be
in sync. Well this is because we have not utilized the most important concept in this
unmodeled gravitational wave search analysis, the coherent combining of data streams, based upon
an a sky location value known ahead of time.</p>
<p>In this example we use a sky location chosen from the sky map assocaited with GW150914
to illustrate what a coherent anlaysis might look like if say you had a Gamma-Ray-Burst
or Supernova counterpart you were following up.</p>
<p>The way we can accomplish this is by either physically shifting the data of N-1 detectors
relative to a baseline detector some delta T amount or we can phase shift the pixels
of the timefrequencymap, here we physically shift the livingston data.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="kn">from</span> <span class="nn">xpipeline.core.xdetector</span> <span class="kn">import</span> <span class="n">Detector</span>

<span class="gp">In [12]: </span><span class="n">hanford</span> <span class="o">=</span> <span class="n">Detector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">)</span>

<span class="gp">In [13]: </span><span class="n">livingston</span> <span class="o">=</span> <span class="n">Detector</span><span class="p">(</span><span class="s1">&#39;L1&#39;</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3801</span><span class="p">;</span> <span class="n">theta</span> <span class="o">=</span> <span class="mf">2.7477</span> <span class="c1"># Earth fixed coordinates</span>

<span class="gp">In [15]: </span><span class="n">time_shift</span> <span class="o">=</span> <span class="n">hanford</span><span class="o">.</span><span class="n">time_delay_from_earth_center_phi_theta</span><span class="p">([</span><span class="n">phi</span><span class="p">],</span> <span class="p">[</span><span class="n">theta</span><span class="p">])</span> <span class="o">-</span> <span class="n">livingston</span><span class="o">.</span><span class="n">time_delay_from_earth_center_phi_theta</span><span class="p">([</span><span class="n">phi</span><span class="p">],</span> <span class="p">[</span><span class="n">theta</span><span class="p">])</span>

<span class="gp">In [16]: </span><span class="n">whitened_timeseries</span><span class="p">[</span><span class="s1">&#39;L1:GDS-CALIB_STRAIN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">time_shift</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># In place shift</span>

<span class="gp">In [17]: </span><span class="n">fft_grams</span> <span class="o">=</span> <span class="n">whitened_timeseries</span><span class="o">.</span><span class="n">fftgram</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span><span class="mi">64</span><span class="p">)</span>

<span class="gp">In [18]: </span><span class="n">energy_maps</span> <span class="o">=</span> <span class="n">fft_grams</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="gp">In [19]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">energy_maps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="gp">In [20]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">gps</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">gps</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [21]: </span><span class="n">plot</span>
<span class="gh">Out[21]: </span><span class="go">&lt;SpectrogramPlot size 1200x600 with 2 Axes&gt;</span>

<span class="gp">In [22]: </span><span class="n">coh_energy_maps</span> <span class="o">=</span> <span class="n">energy_maps</span><span class="o">.</span><span class="n">to_coherent</span><span class="p">()</span>

<span class="gp">In [23]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">coh_energy_maps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="gp">In [24]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">gps</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">gps</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [25]: </span><span class="n">plot</span>
<span class="gh">Out[25]: </span><span class="go">&lt;Plot size 1200x600 with 1 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/plot-time-frequency-map-ts-shifted.png" src="../_images/plot-time-frequency-map-ts-shifted.png" />
<img alt="../_images/plot-time-frequency-map-time-shifted-coherent.png" src="../_images/plot-time-frequency-map-time-shifted-coherent.png" />
</div>
<div class="section" id="clustering-pixels">
<h3>Clustering Pixels<a class="headerlink" href="#clustering-pixels" title="Permalink to this headline">¶</a></h3>
<p>There are a few ways to speed up the processing of the map. Many of the pixels
are not going to be significant, so we can threhold on what pixels we want
(say the loudest 1 percent of pixels) and then employ a method to group the pixels
together in what are referred to as <cite>clusters</cite>. These <cite>clusters</cite> become our possible
gravitational wave <cite>triggers</cite> on which we will later perform statistics on to determine
whether they originate from gravitational wave source or not.</p>
<p>In order to retain the visual key of a time frequency map pixels being grouped
and added together, but also perform algorithmic opertaions quickly we
utilize a subclass of the <cite>scipy.sparse.csc_matrix</cite> class which is designed
to efficiently perform operation on 2D matrices that are mostly zeroes
(which is what happens when we set 99 percent of the pixels to zero).</p>
<p>The algorithm employed to label the remaining pixels in our map into groups
is a nearest neighbor cpp wrapped algorithm called fastlabel.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">energy_map_zeroed</span> <span class="o">=</span> <span class="n">energy_maps</span><span class="o">.</span><span class="n">blackout_pixels</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>

<span class="gp">In [27]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">energy_map_zeroed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="gp">In [28]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">gps</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">gps</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [29]: </span><span class="n">plot</span>
<span class="gh">Out[29]: </span><span class="go">&lt;SpectrogramPlot size 1200x600 with 2 Axes&gt;</span>

<span class="gp">In [30]: </span><span class="n">coh_map</span> <span class="o">=</span> <span class="n">energy_map_zeroed</span><span class="o">.</span><span class="n">to_coherent</span><span class="p">()</span>

<span class="gp">In [31]: </span><span class="n">tf_indices</span> <span class="o">=</span> <span class="n">coh_map</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>

<span class="gp">In [32]: </span><span class="n">tindex</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">tf_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">   ....: </span>          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">energy_maps</span><span class="p">}</span>
<span class="gp">   ....: </span>

<span class="gp">In [33]: </span><span class="n">findex</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">tf_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">   ....: </span>          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">energy_maps</span><span class="p">}</span>
<span class="gp">   ....: </span>

<span class="gp">In [34]: </span><span class="n">energy_map_zeroed</span> <span class="o">=</span> <span class="n">energy_maps</span><span class="o">.</span><span class="n">to_sparse</span><span class="p">(</span><span class="n">tindex</span><span class="p">,</span> <span class="n">findex</span><span class="p">)</span>

<span class="gp">In [35]: </span><span class="n">clusters</span> <span class="o">=</span> <span class="n">energy_map_zeroed</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span>

<span class="gp">In [36]: </span><span class="k">print</span><span class="p">(</span><span class="n">clusters</span><span class="p">)</span>
<span class="go">      min_time_of_cluster  weighted_center_time  max_time_of_cluster  min_frequency_of_cluster  weighted_center_frequency  max_frequency_of_cluster  number_of_pixels  energy_of_cluster</span>
<span class="go">0            1.126259e+09          1.126259e+09         1.126259e+09                     352.0                 384.000000                     416.0               1.0           0.005643</span>
<span class="go">1            1.126259e+09          1.126259e+09         1.126259e+09                     288.0                 320.000000                     352.0               1.0           0.003935</span>
<span class="go">2            1.126259e+09          1.126259e+09         1.126259e+09                     416.0                 448.000000                     480.0               1.0           0.005139</span>
<span class="go">3            1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.003143</span>
<span class="go">4            1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.004165</span>
<span class="go">5            1.126259e+09          1.126259e+09         1.126259e+09                     416.0                 503.588957                     608.0               3.0           0.012433</span>
<span class="go">6            1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.004864</span>
<span class="go">7            1.126259e+09          1.126259e+09         1.126259e+09                     224.0                 256.000000                     288.0               1.0           0.004321</span>
<span class="go">8            1.126259e+09          1.126259e+09         1.126259e+09                     224.0                 256.000000                     288.0               1.0           0.004506</span>
<span class="go">9            1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.003757</span>
<span class="go">10           1.126259e+09          1.126259e+09         1.126259e+09                     224.0                 256.000000                     288.0               1.0           0.004201</span>
<span class="go">11           1.126259e+09          1.126259e+09         1.126259e+09                     352.0                 419.883403                     480.0               2.0           0.008429</span>
<span class="go">12           1.126259e+09          1.126259e+09         1.126259e+09                     224.0                 287.467397                     352.0               2.0           0.008531</span>
<span class="go">13           1.126259e+09          1.126259e+09         1.126259e+09                     480.0                 545.204538                     608.0               2.0           0.012489</span>
<span class="go">14           1.126259e+09          1.126259e+09         1.126259e+09                     480.0                 544.379939                     608.0               2.0           0.009983</span>
<span class="go">15           1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.003333</span>
<span class="go">16           1.126259e+09          1.126259e+09         1.126259e+09                     416.0                 448.000000                     480.0               1.0           0.004619</span>
<span class="go">17           1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.003570</span>
<span class="go">18           1.126259e+09          1.126259e+09         1.126259e+09                     416.0                 478.178499                     544.0               2.0           0.008983</span>
<span class="go">19           1.126259e+09          1.126259e+09         1.126259e+09                     480.0                 546.685147                     608.0               2.0           0.009002</span>
<span class="go">20           1.126259e+09          1.126259e+09         1.126259e+09                     288.0                 320.000000                     352.0               1.0           0.003493</span>
<span class="go">21           1.126259e+09          1.126259e+09         1.126259e+09                     288.0                 320.000000                     352.0               1.0           0.004594</span>
<span class="go">22           1.126259e+09          1.126259e+09         1.126259e+09                     288.0                 349.999050                     416.0               2.0           0.009899</span>
<span class="go">23           1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.004006</span>
<span class="go">24           1.126259e+09          1.126259e+09         1.126259e+09                     416.0                 448.000000                     480.0               1.0           0.003919</span>
<span class="go">25           1.126259e+09          1.126259e+09         1.126259e+09                     224.0                 289.060481                     352.0               2.0           0.009638</span>
<span class="go">26           1.126259e+09          1.126259e+09         1.126259e+09                     544.0                 576.000000                     608.0               1.0           0.003205</span>
<span class="go">27           1.126259e+09          1.126259e+09         1.126259e+09                     160.0                 192.000000                     224.0               1.0           0.003570</span>
<span class="go">28           1.126259e+09          1.126259e+09         1.126259e+09                     288.0                 349.473616                     416.0               2.0           0.010108</span>
<span class="go">29           1.126259e+09          1.126259e+09         1.126259e+09                     480.0                 543.551804                     608.0               2.0           0.007351</span>
<span class="go">...                   ...                   ...                  ...                       ...                        ...                       ...               ...                ...</span>
<span class="go">4360         1.126260e+09          1.126260e+09         1.126260e+09                     480.0                 550.483030                     608.0               2.0           0.009068</span>
<span class="go">4361         1.126260e+09          1.126260e+09         1.126260e+09                     160.0                 192.000000                     224.0               1.0           0.005350</span>
<span class="go">4362         1.126260e+09          1.126260e+09         1.126260e+09                     416.0                 448.000000                     480.0               1.0           0.003765</span>
<span class="go">4363         1.126260e+09          1.126260e+09         1.126260e+09                     160.0                 192.000000                     224.0               1.0           0.005137</span>
<span class="go">4364         1.126260e+09          1.126260e+09         1.126260e+09                     160.0                 192.000000                     224.0               1.0           0.004813</span>
<span class="go">4365         1.126260e+09          1.126260e+09         1.126260e+09                     352.0                 384.000000                     416.0               1.0           0.004061</span>
<span class="go">4366         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.004547</span>
<span class="go">4367         1.126260e+09          1.126260e+09         1.126260e+09                     416.0                 448.000000                     480.0               1.0           0.003775</span>
<span class="go">4368         1.126260e+09          1.126260e+09         1.126260e+09                     160.0                 192.000000                     224.0               1.0           0.004073</span>
<span class="go">4369         1.126260e+09          1.126260e+09         1.126260e+09                     288.0                 350.994046                     416.0               2.0           0.009694</span>
<span class="go">4370         1.126260e+09          1.126260e+09         1.126260e+09                     416.0                 448.000000                     480.0               1.0           0.005020</span>
<span class="go">4371         1.126260e+09          1.126260e+09         1.126260e+09                     160.0                 192.000000                     224.0               1.0           0.004732</span>
<span class="go">4372         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.003947</span>
<span class="go">4373         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.004673</span>
<span class="go">4374         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.004403</span>
<span class="go">4375         1.126260e+09          1.126260e+09         1.126260e+09                     416.0                 448.000000                     480.0               1.0           0.003591</span>
<span class="go">4376         1.126260e+09          1.126260e+09         1.126260e+09                     416.0                 482.572551                     544.0               2.0           0.007921</span>
<span class="go">4377         1.126260e+09          1.126260e+09         1.126260e+09                     352.0                 384.000000                     416.0               1.0           0.003609</span>
<span class="go">4378         1.126260e+09          1.126260e+09         1.126260e+09                     416.0                 476.278025                     544.0               2.0           0.008425</span>
<span class="go">4379         1.126260e+09          1.126260e+09         1.126260e+09                     288.0                 320.000000                     352.0               1.0           0.005852</span>
<span class="go">4380         1.126260e+09          1.126260e+09         1.126260e+09                     288.0                 352.303467                     416.0               2.0           0.011275</span>
<span class="go">4381         1.126260e+09          1.126260e+09         1.126260e+09                     352.0                 418.057645                     480.0               2.0           0.009032</span>
<span class="go">4382         1.126260e+09          1.126260e+09         1.126260e+09                     224.0                 289.985734                     352.0               2.0           0.009464</span>
<span class="go">4383         1.126260e+09          1.126260e+09         1.126260e+09                     288.0                 320.000000                     352.0               1.0           0.005937</span>
<span class="go">4384         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.004679</span>
<span class="go">4385         1.126260e+09          1.126260e+09         1.126260e+09                      96.0                 163.241496                     224.0               2.0           0.008354</span>
<span class="go">4386         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.003992</span>
<span class="go">4387         1.126260e+09          1.126260e+09         1.126260e+09                     544.0                 576.000000                     608.0               1.0           0.003627</span>
<span class="go">4388         1.126260e+09          1.126260e+09         1.126260e+09                     160.0                 192.000000                     224.0               1.0           0.003405</span>
<span class="go">4389         1.126260e+09          1.126260e+09         1.126260e+09                     288.0                 320.000000                     352.0               1.0           0.003649</span>

<span class="go">[4390 rows x 8 columns]</span>
</pre></div>
</div>
<img alt="../_images/plot-sparse-ind-tfmaps.png" src="../_images/plot-sparse-ind-tfmaps.png" />
<p>Now the we have labelled our remaining pixels (the non-zeroed out pixels), let’s extract
some of the cluster properites of these clusters. i.e. how many pixels are in the cluster
the bounding box of the cluster (i.e. [[min-time, max-time], [min-freq, max-freq]] and the
sum of energy over the cluster.</p>
<p>Specifically, the cpp wrapped function <cite>clusterproperities</cite> outputs the following information</p>
<blockquote>
<div><ul class="simple">
<li>column 0: minimum time of cluster</li>
<li>column 1: weighted center time of cluster</li>
<li>column 2: maximum time of cluster</li>
<li>column 3: minimum frequency of cluster</li>
<li>column 4: weighted center frequency of cluster</li>
<li>column 5: maximum frequency of cluster</li>
<li>column 6: number of pixels in cluster</li>
<li>column 7: sum-over-cluster map values for each likelihood</li>
</ul>
</div></blockquote>
<p>Before we do this though, we must re-make our sparse maps.
for we have zeroed out some pixels in either map that are now part of our
clusters. i.e. some pixels may have been in the top 1 percent of one but not
all maps.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [37]: </span><span class="n">loudest_cluster_idx</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;energy_of_cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

<span class="gp">In [38]: </span><span class="n">min_time</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;min_time_of_cluster&#39;</span><span class="p">][</span><span class="n">loudest_cluster_idx</span><span class="p">];</span> <span class="n">max_time</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;max_time_of_cluster&#39;</span><span class="p">][</span><span class="n">loudest_cluster_idx</span><span class="p">];</span> <span class="n">weighted_center_time</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;weighted_center_time&#39;</span><span class="p">][</span><span class="n">loudest_cluster_idx</span><span class="p">];</span> <span class="n">min_freq</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;min_frequency_of_cluster&#39;</span><span class="p">][</span><span class="n">loudest_cluster_idx</span><span class="p">];</span> <span class="n">max_freq</span> <span class="o">=</span> <span class="n">clusters</span><span class="p">[</span><span class="s1">&#39;max_frequency_of_cluster&#39;</span><span class="p">][</span><span class="n">loudest_cluster_idx</span><span class="p">];</span>

<span class="gp">In [39]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">energy_map_zeroed</span><span class="o">.</span><span class="n">to_xtimefrequencymapdict</span><span class="p">()</span><span class="o">.</span><span class="n">to_coherent</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="gp">In [40]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">weighted_center_time</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [41]: </span><span class="n">plot</span>
<span class="gh">Out[41]: </span><span class="go">&lt;Plot size 1200x600 with 1 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/loudest-cluster-gw150914.png" src="../_images/loudest-cluster-gw150914.png" />
</div>
<div class="section" id="the-dominant-polarization-frame">
<h3>The Dominant Polarization Frame<a class="headerlink" href="#the-dominant-polarization-frame" title="Permalink to this headline">¶</a></h3>
<p>Now the we have a sky location assosciated with the event we can project every time-freqeuncy pixel
into the Dominant Polarization Frame (DPF). What this means is that we assume the GW has a plus and cross
polarization there is some orthoganal projection of the pixels onto the plus-cross plane for 2 or more detectors</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [42]: </span><span class="kn">from</span> <span class="nn">xpipeline.core.xdetector</span> <span class="kn">import</span> <span class="n">compute_antenna_patterns</span>

<span class="gp">In [43]: </span><span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3801</span><span class="p">;</span> <span class="n">theta</span> <span class="o">=</span> <span class="mf">2.7477</span> <span class="c1"># Earth fixed coordinates</span>

<span class="gp">In [44]: </span><span class="n">antenna_patterns</span> <span class="o">=</span> <span class="n">compute_antenna_patterns</span><span class="p">([</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;L1&#39;</span><span class="p">],</span> <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">antenna_patterns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;f_cross&#39;</span><span class="p">,</span> <span class="s1">&#39;f_scalar&#39;</span><span class="p">])</span>

<span class="gp">In [45]: </span><span class="n">projected_asds</span> <span class="o">=</span> <span class="n">asds</span><span class="o">.</span><span class="n">project_onto_antenna_patterns</span><span class="p">(</span><span class="n">antenna_patterns</span><span class="p">,</span> <span class="n">to_dominant_polarization_frame</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">In [46]: </span><span class="n">projected_fftmaps</span> <span class="o">=</span> <span class="n">fft_grams</span><span class="o">.</span><span class="n">to_dominant_polarization_frame</span><span class="p">(</span><span class="n">projected_asds</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have projected each pixels onto the plus and cross phase + amplitude space
Let’s see what it looks like if we simply take these projections and plot them.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [47]: </span><span class="n">sparse_projected_fftmaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to_sparse</span><span class="p">(</span><span class="n">tindex</span><span class="p">,</span> <span class="n">findex</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">projected_fftmaps</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="gp">In [48]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">sparse_projected_fftmaps</span><span class="p">[</span><span class="s1">&#39;f_plus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_xtimefrequencymapdict</span><span class="p">()</span><span class="o">.</span><span class="n">to_coherent</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="gp">In [49]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">weighted_center_time</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [50]: </span><span class="n">plot</span>
<span class="gh">Out[50]: </span><span class="go">&lt;Plot size 1200x600 with 1 Axes&gt;</span>

<span class="gp">In [51]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">sparse_projected_fftmaps</span><span class="p">[</span><span class="s1">&#39;f_cross&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_xtimefrequencymapdict</span><span class="p">()</span><span class="o">.</span><span class="n">to_coherent</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="gp">In [52]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">weighted_center_time</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_freq</span><span class="p">,</span> <span class="n">max_freq</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [53]: </span><span class="n">plot</span>
<span class="gh">Out[53]: </span><span class="go">&lt;Plot size 1200x600 with 1 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/fplus-gw150914.png" src="../_images/fplus-gw150914.png" />
<img alt="../_images/fcross-gw150914.png" src="../_images/fcross-gw150914.png" />
</div>
<div class="section" id="likelihoods">
<h3>Likelihoods<a class="headerlink" href="#likelihoods" title="Permalink to this headline">¶</a></h3>
<p>So now that we have possible graviational wave candidates in the form
of clusters of loud pixels and the projected values of those pixels,
how do we “rank” these clusters in order or more or less likely to have orginiated from
graviational wave origins.</p>
</div>
<div class="section" id="the-waveform">
<h3>The Waveform<a class="headerlink" href="#the-waveform" title="Permalink to this headline">¶</a></h3>
<p>In order to train these likelihoods so we can understand what values to expect from
gravitational wave clusters instead of random noise fluctations or <cite>glitches</cite> we must
inject a number of fake gravitational wave like signals.</p>
<p>This involves to steps, generating a gravitational-wave like waveform on the fly
and then injecting that signal into a stretch of data.</p>
<p>The parametrs that go into xmakewaveform are the <cite>family</cite> of waveform, a set of parameters specific for that
waveform. In this case, the hrss is the quadrature sum of the RSS amplitudes of the plus and cross
polarizations, tau is the duration, f0 is the central frequency, alpha is
the chirp parameter, and delta is the phase at the peak of the envelope.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [54]: </span><span class="kn">from</span> <span class="nn">xpipeline.waveform</span> <span class="kn">import</span> <span class="n">xwaveform</span>

<span class="gp">In [55]: </span><span class="kn">from</span> <span class="nn">gwpy.plotter</span> <span class="kn">import</span> <span class="n">TimeSeriesPlot</span>

<span class="gp">In [56]: </span><span class="n">t</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">hb</span> <span class="o">=</span> <span class="n">xwaveform</span><span class="o">.</span><span class="n">xmakewaveform</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;chirplet&#39;</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-22</span><span class="p">,</span> <span class="mf">0.0033</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">T</span><span class="o">=</span><span class="mi">513</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="mf">256.6161</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<span class="gp">In [57]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">TimeSeriesPlot</span><span class="p">(</span><span class="n">hp</span><span class="p">,</span> <span class="n">hc</span><span class="p">)</span>

<span class="gp">In [58]: </span><span class="n">plot</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="mf">256.6161</span><span class="p">)</span>

<span class="gp">In [59]: </span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">256.6161</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">256.6161</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">])</span>

<span class="gp">In [60]: </span><span class="n">plot</span>
<span class="gh">Out[60]: </span><span class="go">&lt;TimeSeriesPlot size 1200x600 with 1 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/chirplet.png" src="../_images/chirplet.png" />
<p>Now let’s say this is not an analytical waveform and instead an hplus and hcross
from say a supernova simulation. We can also handles that, tracked by <cite>git-lfs</cite>,
the waveforms folder of X-Pypeline repository houses a number of hdf5 files
full of pregenerated waveforms.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [61]: </span><span class="kn">from</span> <span class="nn">xpipeline.waveform</span> <span class="kn">import</span> <span class="n">xwaveform</span>

<span class="gp">In [62]: </span><span class="kn">from</span> <span class="nn">gwpy.plotter</span> <span class="kn">import</span> <span class="n">TimeSeriesPlot</span>

<span class="gp">In [63]: </span><span class="n">t</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">hb</span> <span class="o">=</span> <span class="n">xwaveform</span><span class="o">.</span><span class="n">xmakewaveform</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Morozova2018&#39;</span><span class="p">,</span>
<span class="gp">   ....: </span>    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;M10_LS220&#39;</span><span class="p">],</span>
<span class="gp">   ....: </span>    <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">16384</span><span class="p">,</span> <span class="n">catalogdirectory</span><span class="o">=</span><span class="s1">&#39;../waveforms/&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [64]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">TimeSeriesPlot</span><span class="p">(</span><span class="n">hp</span><span class="p">,</span> <span class="n">hc</span><span class="p">)</span>

<span class="gp">In [65]: </span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>

<span class="gp">In [66]: </span><span class="n">plot</span>
<span class="gh">Out[66]: </span><span class="go">&lt;TimeSeriesPlot size 1200x600 with 1 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/supernova-R4E1FC_L_theta2.094_phi2.094.png" src="../_images/supernova-R4E1FC_L_theta2.094_phi2.094.png" />
</div>
<div class="section" id="the-injection">
<h3>The Injection<a class="headerlink" href="#the-injection" title="Permalink to this headline">¶</a></h3>
<p>In a coherent search it is not enough to simply inject any old signal.
You must take in a set of sky coordinates and project an individual
signal with its antenna pattern (for example Fp*hp and Fc*hc)
just like we do for the data. Let us say we have the SN waveform from above
now we will assume this SN signal occurred at the same earth fixed coordinates
of GW150914 from above, but since this is a simulation let us imagine VIRGO was
on at the time too.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [67]: </span><span class="kn">from</span> <span class="nn">xpipeline.waveform</span> <span class="kn">import</span> <span class="n">xinjectsignal</span>

<span class="gp">In [68]: </span><span class="n">start_time</span> <span class="o">=</span> <span class="mf">1156609396.0</span><span class="p">;</span> <span class="n">block_time</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span> <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;L1&#39;</span><span class="p">];</span> <span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">8192</span><span class="p">;</span> <span class="n">injection_file_name</span> <span class="o">=</span><span class="s1">&#39;examples/injection_Morozova.txt&#39;</span><span class="p">;</span> <span class="n">injection_number</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="n">catalogdirectory</span><span class="o">=</span><span class="s1">&#39;../waveforms/&#39;</span><span class="p">;</span>

<span class="gp">In [69]: </span><span class="p">[</span><span class="n">injection_data</span><span class="p">,</span> <span class="n">gps_s</span><span class="p">,</span> <span class="n">gps_ns</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">psi</span><span class="p">]</span> <span class="o">=</span> <span class="n">xinjectsignal</span><span class="o">.</span><span class="n">xinjectsignal_fromfile</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">block_time</span><span class="o">=</span><span class="n">block_time</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">,</span> <span class="n">injection_file_name</span><span class="o">=</span><span class="n">injection_file_name</span><span class="p">,</span> <span class="n">injection_number</span><span class="o">=</span><span class="n">injection_number</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">catalogdirectory</span><span class="o">=</span><span class="n">catalogdirectory</span><span class="p">)</span>

<span class="gp">In [70]: </span><span class="kn">from</span> <span class="nn">gwpy.plotter</span> <span class="kn">import</span> <span class="n">TimeSeriesPlot</span>

<span class="gp">In [71]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">TimeSeriesPlot</span><span class="p">()</span>

<span class="gp">In [72]: </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">injection_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">   ....: </span>    <span class="n">plot</span><span class="o">.</span><span class="n">add_timeseries</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [73]: </span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">gps_s</span><span class="p">,</span> <span class="n">gps_s</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>

<span class="gp">In [74]: </span><span class="n">plot</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
<span class="gh">Out[74]: </span><span class="go">&lt;matplotlib.legend.Legend at 0x11dccf4a8&gt;</span>

<span class="gp">In [75]: </span><span class="n">plot</span>
<span class="go">                                                   Out[75]: &lt;TimeSeriesPlot size 1200x600 with 1 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/Morozova2018-h1-l1.png" src="../_images/Morozova2018-h1-l1.png" />
<p>Now let’s inject this into some data, we could use real data but let’s just generate
some data and color it to look like gaussian distributed aLIGO noise.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [76]: </span><span class="n">colored_gaussian_noise</span> <span class="o">=</span> <span class="n">XTimeSeries</span><span class="o">.</span><span class="n">generate_noise_from_file</span><span class="p">(</span><span class="s1">&#39;../noise/aLIGOZeroDetHighPower.h5&#39;</span><span class="p">,</span> <span class="n">event_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">block_time</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">channel_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;L1&#39;</span><span class="p">],</span> <span class="n">sample_frequency</span><span class="o">=</span><span class="mi">8192</span><span class="p">)</span>

<span class="gp">In [77]: </span><span class="n">data_plus_signal</span> <span class="o">=</span> <span class="n">colored_gaussian_noise</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">injection_data</span><span class="p">)</span>

<span class="gp">In [78]: </span><span class="n">asds</span> <span class="o">=</span> <span class="n">data_plus_signal</span><span class="o">.</span><span class="n">asd</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="gp">In [79]: </span><span class="n">whitened_timeseries</span> <span class="o">=</span> <span class="n">data_plus_signal</span><span class="o">.</span><span class="n">whiten</span><span class="p">(</span><span class="n">asds</span><span class="p">)</span>

<span class="gp">In [80]: </span><span class="n">fft_maps</span> <span class="o">=</span> <span class="n">whitened_timeseries</span><span class="o">.</span><span class="n">fftgram</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span><span class="mi">64</span><span class="p">)</span>

<span class="gp">In [81]: </span><span class="n">energy_maps</span> <span class="o">=</span> <span class="n">fft_maps</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="gp">In [82]: </span><span class="n">plot</span> <span class="o">=</span> <span class="n">energy_maps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="gp">In [83]: </span><span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">gps_s</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">gps_s</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_epoch</span><span class="p">(</span><span class="n">gps_s</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [milliseconds]&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [84]: </span><span class="n">plot</span>
<span class="gh">Out[84]: </span><span class="go">&lt;SpectrogramPlot size 1200x600 with 2 Axes&gt;</span>
</pre></div>
</div>
<img alt="../_images/energy-map-Morozova2018.png" src="../_images/energy-map-Morozova2018.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../command-line/index.html" class="btn btn-neutral" title="Running xpipeline-workflow on the command line" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Scott Coughlin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0+untagged.99.g8960fa3.dirty',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>